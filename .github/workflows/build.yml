name: build

on:
  push:

jobs:
  build:
    runs-on: windows-2022
    strategy:
      matrix:
        commit:
          - 1d4369c2ff3c8df0528fc5ac972a1a76e2adcfc9
          - 126ba1a166090dd5605995921d964c6a6e9e0a88
          - d883932586a1f1f14f3ab3aa7f2f7e2475264e19
          - b86641a4c20fc9709bba0d9056821689a4c6d081
          - master
    steps:
      - uses: actions/checkout@v3
      - name: Download Eigen
        run: |
          git clone https://gitlab.com/libeigen/eigen.git
          git checkout ${{ matrix.commit }}
      - name: Install Eigen
        run: |
          cmake -Bbuild -S. `
            -A Win32 `
            -D CMAKE_INSTALL_PREFIX="$(pwd)/../install-eigen" `
            -D CMAKE_Fortran_COMPILER="NOTFOUND" `
            -D BUILD_TESTING=Off
          cmake --build build --config Release
          cmake --install build --config Release
        working-directory: eigen
        shell: pwsh
      - name: Build example project
        run: |
          cmake -Bbuild -S. `
            -A Win32 `
            -D Eigen3_DIR="$(pwd)/install-eigen/share/eigen3/cmake"
          cmake --build build --config Release
        shell: pwsh
